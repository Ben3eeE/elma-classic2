#ifndef RECORDER_H
#define RECORDER_H

#include "HANGHIGH.H"
#include "vect2.h"
#include <cstdio>

struct motorst;

struct hanginfo {
    double frekvencia;
    char gaz;
    double surlero;
};

struct egyhang {
    double t;
    short objszam;
    WavEvent wavindex;
    float hangero;
};

int loadrecek(const char* nev, int demo);
void saverecek(const char* nev, int belyeg, int tag);

class recorder {
    // demo eseten resource file-bol nyit:
    // belyeg-et adja vissza, vagy 0-at:
    friend int loadrecek(const char* nev, int demo);
    friend void saverecek(const char* nev, int belyeg, int tag);
    friend void replay(void); // Hogy betolthoz hozzaferjen

    float *pk1rx, *pk1ry;
    short *pk2rx, *pk2ry, *pk4rx, *pk4ry;
    short *pvezrx, *pvezry;
    unsigned char *pk2alfa, *pk4alfa;
    short* pk1alfa;
    unsigned char *pfrekvencia, *psurlero;
    unsigned char* pgazhatra;

    int betoltve;
    int ucsokiadva;

    egyhang* phangok;
    int hangbetoltve;
    int hangkov;

    vect2 ucso_r;
    double ucsot, legkozt;
    int legkozindex;

    int tag;
    // demo eseten resource file-bol nyit:
    // belyeg-et adja vissza, vagy 0-at:
    int load(const char* nev, FILE* h, int demo);
    void save(const char* nev, FILE* h, int belyeg, int tag);

  public:
    char palyanev[16];

    recorder(void);
    ~recorder(void);
    void erase(char* palyanev);
    void rewind(void);
    // Ez a ket fuggveny  meg ezt a ket globalis valtozot is
    // beveszi es allitja: FlagTagAHasFlag FlagTagImmunity:
    int recall(motorst* pmot, double ido, hanginfo* phinfo);
    void store(motorst* pmot, double ido, hanginfo* phinfo);

    void addhang(double t, WavEvent wavindex, double hangero, int objszam);
    // Ha van hang, akkor igazzal ter vissza:
    int gethang(double t, WavEvent* pwavindex, double* phangero, int* pobjszam);

    int gettag(void);
    void settag(int tag_p);

    void encode_frame_count();
    bool frame_count_integrity();
};

extern recorder *Prec1, *Prec2;
// Ha multiplayer a bentlevo rec, akkor ez igaz:
// long lejatszo( void ) allithatja, vagy loadrecek:
extern int Multirec;

void startwavegyujto(WavEvent wavazonosito, double hangero, int objszam);
void resetwavegyujto(void);
// Igaz, ha van bent wav:
int getwavegyujto(WavEvent* pwavazonosito, double* phangero, int* pobjszam);

#endif
